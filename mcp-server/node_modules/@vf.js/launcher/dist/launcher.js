/*!
 * launcher.js 
 *  Compiled Tue May 11 2021 16:45:20 GMT+0800 (China Standard Time) 
 *  https://vipkid-edu.github.io/vf-docs/
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else {
		var a = factory();
		for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];
	}
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./packages/launcher/src/index.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./assets/loading2.svg":
/*!*****************************!*\
  !*** ./assets/loading2.svg ***!
  \*****************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony default export */ __webpack_exports__["default"] = ("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBzdHlsZT0ibWFyZ2luOiBhdXRvOyAgZGlzcGxheTogYmxvY2s7IHNoYXBlLXJlbmRlcmluZzogYXV0bzsiIHdpZHRoPSI0MXB4IiBoZWlnaHQ9IjQxcHgiIHZpZXdCb3g9IjAgMCAxMDAgMTAwIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCI+CjxnIHRyYW5zZm9ybT0icm90YXRlKDAgNTAgNTApIj4KICA8cmVjdCB4PSI0NiIgeT0iMjkiIHJ4PSI0IiByeT0iMyIgd2lkdGg9IjgiIGhlaWdodD0iNiIgID4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIHZhbHVlcz0iMTswIiBrZXlUaW1lcz0iMDsxIiBkdXI9IjFzIiBiZWdpbj0iLTAuOTE2NjY2NjY2NjY2NjY2NnMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+CiAgPC9yZWN0Pgo8L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMzAgNTAgNTApIj4KICA8cmVjdCB4PSI0NiIgeT0iMjkiIHJ4PSI0IiByeT0iMyIgd2lkdGg9IjgiIGhlaWdodD0iNiIgID4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIHZhbHVlcz0iMTswIiBrZXlUaW1lcz0iMDsxIiBkdXI9IjFzIiBiZWdpbj0iLTAuODMzMzMzMzMzMzMzMzMzNHMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+CiAgPC9yZWN0Pgo8L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoNjAgNTAgNTApIj4KICA8cmVjdCB4PSI0NiIgeT0iMjkiIHJ4PSI0IiByeT0iMyIgd2lkdGg9IjgiIGhlaWdodD0iNiIgID4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIHZhbHVlcz0iMTswIiBrZXlUaW1lcz0iMDsxIiBkdXI9IjFzIiBiZWdpbj0iLTAuNzVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPgogIDwvcmVjdD4KPC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDkwIDUwIDUwKSI+CiAgPHJlY3QgeD0iNDYiIHk9IjI5IiByeD0iNCIgcnk9IjMiIHdpZHRoPSI4IiBoZWlnaHQ9IjYiICA+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiB2YWx1ZXM9IjE7MCIga2V5VGltZXM9IjA7MSIgZHVyPSIxcyIgYmVnaW49Ii0wLjY2NjY2NjY2NjY2NjY2NjZzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPgogIDwvcmVjdD4KPC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDEyMCA1MCA1MCkiPgogIDxyZWN0IHg9IjQ2IiB5PSIyOSIgcng9IjQiIHJ5PSIzIiB3aWR0aD0iOCIgaGVpZ2h0PSI2IiAgPgogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgdmFsdWVzPSIxOzAiIGtleVRpbWVzPSIwOzEiIGR1cj0iMXMiIGJlZ2luPSItMC41ODMzMzMzMzMzMzMzMzM0cyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT4KICA8L3JlY3Q+CjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgxNTAgNTAgNTApIj4KICA8cmVjdCB4PSI0NiIgeT0iMjkiIHJ4PSI0IiByeT0iMyIgd2lkdGg9IjgiIGhlaWdodD0iNiIgID4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIHZhbHVlcz0iMTswIiBrZXlUaW1lcz0iMDsxIiBkdXI9IjFzIiBiZWdpbj0iLTAuNXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+CiAgPC9yZWN0Pgo8L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMTgwIDUwIDUwKSI+CiAgPHJlY3QgeD0iNDYiIHk9IjI5IiByeD0iNCIgcnk9IjMiIHdpZHRoPSI4IiBoZWlnaHQ9IjYiICA+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiB2YWx1ZXM9IjE7MCIga2V5VGltZXM9IjA7MSIgZHVyPSIxcyIgYmVnaW49Ii0wLjQxNjY2NjY2NjY2NjY2NjdzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPgogIDwvcmVjdD4KPC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDIxMCA1MCA1MCkiPgogIDxyZWN0IHg9IjQ2IiB5PSIyOSIgcng9IjQiIHJ5PSIzIiB3aWR0aD0iOCIgaGVpZ2h0PSI2IiAgPgogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgdmFsdWVzPSIxOzAiIGtleVRpbWVzPSIwOzEiIGR1cj0iMXMiIGJlZ2luPSItMC4zMzMzMzMzMzMzMzMzMzMzcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT4KICA8L3JlY3Q+CjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgyNDAgNTAgNTApIj4KICA8cmVjdCB4PSI0NiIgeT0iMjkiIHJ4PSI0IiByeT0iMyIgd2lkdGg9IjgiIGhlaWdodD0iNiIgID4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIHZhbHVlcz0iMTswIiBrZXlUaW1lcz0iMDsxIiBkdXI9IjFzIiBiZWdpbj0iLTAuMjVzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPgogIDwvcmVjdD4KPC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDI3MCA1MCA1MCkiPgogIDxyZWN0IHg9IjQ2IiB5PSIyOSIgcng9IjQiIHJ5PSIzIiB3aWR0aD0iOCIgaGVpZ2h0PSI2IiAgPgogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgdmFsdWVzPSIxOzAiIGtleVRpbWVzPSIwOzEiIGR1cj0iMXMiIGJlZ2luPSItMC4xNjY2NjY2NjY2NjY2NjY2NnMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+CiAgPC9yZWN0Pgo8L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMzAwIDUwIDUwKSI+CiAgPHJlY3QgeD0iNDYiIHk9IjI5IiByeD0iNCIgcnk9IjMiIHdpZHRoPSI4IiBoZWlnaHQ9IjYiICA+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiB2YWx1ZXM9IjE7MCIga2V5VGltZXM9IjA7MSIgZHVyPSIxcyIgYmVnaW49Ii0wLjA4MzMzMzMzMzMzMzMzMzMzcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT4KICA8L3JlY3Q+CjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgzMzAgNTAgNTApIj4KICA8cmVjdCB4PSI0NiIgeT0iMjkiIHJ4PSI0IiByeT0iMyIgd2lkdGg9IjgiIGhlaWdodD0iNiIgID4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIHZhbHVlcz0iMTswIiBrZXlUaW1lcz0iMDsxIiBkdXI9IjFzIiBiZWdpbj0iMHMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+CiAgPC9yZWN0Pgo8L2c+CjwhLS0gW2xkaW9dIGdlbmVyYXRlZCBieSBodHRwczovL2xvYWRpbmcuaW8vIC0tPjwvc3ZnPg==");

/***/ }),

/***/ "./packages/launcher/src/CreateApp.ts":
/*!********************************************!*\
  !*** ./packages/launcher/src/CreateApp.ts ***!
  \********************************************/
/*! exports provided: CreateApp */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CreateApp", function() { return CreateApp; });
/* eslint-disable @typescript-eslint/explicit-function-return-type */
/* eslint-disable @typescript-eslint/no-unused-vars */
/* eslint-disable no-unused-vars */
var CreateApp = /** @class */ (function () {
    function CreateApp(options) {
        /**
         * @private
         * @type {VFStage}
         */
        this._readyState = "init" /* INIT */;
        /**
         * 接口，避免写入逻辑
         */
        // eslint-disable-next-line handle-callback-err
        this.onError = function (err) {
            //
        };
        /**
         * 接口，避免写入逻辑
         */
        this.onInit = function () {
            //
        };
        /**
         * 接口，避免写入逻辑
         */
        this.onReady = function () {
            //
        };
        /**
         * 接口，避免写入逻辑
         */
        this.onSceneLoad = function (msg) {
            //
        };
        /**
         * 接口，避免写入逻辑
         */
        this.onSceneLoadProgress = function (msg) {
            //
        };
        /**
         * 接口，避免写入逻辑
         */
        this.onSceneCreate = function (msg) {
            //
        };
        /**
         * 接口，避免写入逻辑
         */
        this.onMessage = function (msg) {
            //
        };
        /**
         * 接口，避免写入逻辑
         */
        this.onDispose = function () {
            //
        };
        // super();
        // 1. 初始化配置
        this.option = options;
        // 2. 初始化引擎 + GUI
        var info = this.createApp();
        this.app = info.app;
        this.uiStage = info.uiStage;
        info.uiStage.on("message" /* MESSAGE */, this.sendMessage, this); // 推送消息
        info.uiStage.on("status" /* STATUS */, this.onStatus, this); // 状态变化
        this.readyState = "init" /* INIT */;
    }
    Object.defineProperty(CreateApp.prototype, "readyState", {
        get: function () {
            return this._readyState;
        },
        set: function (value) {
            this._readyState = value;
            this.uiStage.emit("status" /* STATUS */, { code: value, level: "status" /* STATUS */, data: value });
        },
        enumerable: false,
        configurable: true
    });
    CreateApp.prototype.createApp = function () {
        var options = this.option;
        var app = this.app = new vf.Application({
            backgroundColor: parseInt(options.bgcolor || '0', 16),
            transparent: options.wmode === 'transparent',
            antialias: true,
            resolution: options.resolution,
            forceCanvas: options.forceCanvas,
            powerPreference: 'low-power',
        });
        options.container.appendChild(this.app.view);
        var vfUtils = vf.gui.Utils;
        var clientRect = vfUtils.getBoundingClientRect(options.container);
        var stageW = vfUtils.formatRelative(options.width, clientRect.width);
        var stageH = vfUtils.formatRelative(options.height, clientRect.height);
        // 创建GUI
        var uiStage = new vf.gui.Stage(stageW, stageH, app);
        // 适配处理, 这块由于播放器项目中的JSON有设置scaleMode属性，所以无法通用，后续可想方式统一创建
        vfUtils.calculateUpdatePlayerSize(options.container, app, uiStage, stageW, stageH, options.scaleMode);
        var frameRate = options.frameRate || 30;
        app.ticker.maxFPS = frameRate;
        vf.Ticker.system.maxFPS = frameRate;
        vf.Ticker.shared.stop();
        vf.Ticker.shared.maxFPS = frameRate;
        vf.gui.TickerShared.maxFPS = frameRate;
        vf.gui.Utils.debug = options.debug || false;
        return { app: app, uiStage: uiStage };
    };
    Object.defineProperty(CreateApp.prototype, "Main", {
        get: function () {
            return this._main;
        },
        enumerable: false,
        configurable: true
    });
    /** ===================== ============================ */
    CreateApp.prototype.play = function (src, packageName) {
        var _this = this;
        if (src && packageName) {
            vf.utils.readFileSync(src, { moduleName: packageName }).then(function (ValueClass) {
                _this._main = new ValueClass(_this);
                _this.readyState = "ready" /* READY */;
            });
        }
    };
    // ------------------------- 外部与钩子 ---------------------------//
    /**
     * 接收到服务
     * @param msg
     */
    CreateApp.prototype.sendMessage = function (msg) {
        if (this.onMessage) {
            this.onMessage(msg);
        }
    };
    /**
     * 接收到的状态
     * @param msg
     */
    CreateApp.prototype.onStatus = function (msg) {
        if (msg.level === "error" /* error */ || msg.level === "warning" /* warning */) {
            if (this.onError) {
                this.onError(msg);
            }
            return;
        }
        switch (msg.code) {
            case "init" /* INIT */:
                if (this.onInit) {
                    this.onInit();
                }
                break;
            case "ready" /* READY */:
                if (this.onReady) {
                    this.onReady();
                }
                break;
            case "SceneLoad" /* SceneLoad */:
                if (this.onSceneLoad) {
                    this.onSceneLoad(msg);
                }
                break;
            case "LoadProgress" /* LoadProgress */:
                if (this.onSceneLoadProgress) {
                    this.onSceneLoadProgress(msg);
                }
                break;
            case "ScenComplete" /* ScenComplete */:
                if (this.onSceneCreate) {
                    this.onSceneCreate(msg);
                }
                break;
        }
    };
    CreateApp.prototype.sendCommand = function (msg) {
        if (msg.level === undefined) {
            msg.level = "command" /* COMMAND */;
        }
        this.uiStage.emit("onMessage" /* ONMESSAGE */, msg);
    };
    /**
     * 设置消息，外部接口
     * @param msg
     */
    CreateApp.prototype.message = function (msg) {
        if (typeof msg !== 'object' || msg.code === undefined || msg.level === undefined) {
            this.onError({ code: 'error', message: 'vf message 消息格式异常', data: msg, level: 'error' });
            return;
        }
        msg.$system = true;
        this.sendCommand(msg);
    };
    CreateApp.prototype.pause = function () {
        this.sendCommand({ code: 'pause' });
    };
    CreateApp.prototype.resume = function () {
        this.sendCommand({ code: 'resume' });
    };
    CreateApp.prototype.reset = function () {
        this.sendCommand({ code: 'reset' });
    };
    CreateApp.prototype.switchToNextScene = function (transition) {
        this.sendCommand({ code: 'switchToNextScene', data: transition });
    };
    CreateApp.prototype.switchToPrevScene = function (transition) {
        this.sendCommand({ code: 'switchToPrevScene', data: transition });
    };
    CreateApp.prototype.switchToSceneId = function (sceneId, transition) {
        this.sendCommand({ code: 'switchToSceneId', data: { sceneId: sceneId, transition: transition } });
    };
    CreateApp.prototype.switchToSceneIndex = function (index, transition) {
        this.sendCommand({ code: 'switchToSceneIndex', data: { index: index, transition: transition } });
    };
    CreateApp.prototype.dispose = function () {
        if (this.readyState === "disabled" /* DISABLED */) {
            return;
        }
        this.readyState = "disabled" /* DISABLED */;
        if (this._main && this._main.releaseAll) {
            this._main.releaseAll();
        }
        this._main = undefined;
        this.onDispose();
    };
    CreateApp.prototype.destroy = function () {
        vf.AudioEngine.Ins().dispose();
        this.dispose();
        this.uiStage.offAll();
        this.uiStage.releaseAll();
        this.app.destroy(true, { children: true, texture: true, baseTexture: true });
        this.option = null;
        this.app = null;
        this.uiStage = null;
    };
    return CreateApp;
}());



/***/ }),

/***/ "./packages/launcher/src/Launcher.ts":
/*!*******************************************!*\
  !*** ./packages/launcher/src/Launcher.ts ***!
  \*******************************************/
/*! exports provided: deleteVF, VIPKIDLauncher, createVF */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "deleteVF", function() { return deleteVF; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "VIPKIDLauncher", function() { return VIPKIDLauncher; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createVF", function() { return createVF; });
/* harmony import */ var _Loading__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Loading */ "./packages/launcher/src/Loading.ts");
/* harmony import */ var _getDefaultCDN__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./getDefaultCDN */ "./packages/launcher/src/getDefaultCDN.ts");
/* harmony import */ var _getQueryVariable__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./getQueryVariable */ "./packages/launcher/src/getQueryVariable.ts");
/* harmony import */ var _CreateApp__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./CreateApp */ "./packages/launcher/src/CreateApp.ts");




window['vf'] && window['vf']['launcherPlayer'];
function deleteVF() {
    var list = document.getElementsByName('vf-script');
    var vfLibs = [];
    list.forEach(function (value) {
        if (value.title !== '' && value.hasAttribute('isLoad')) {
            vfLibs.push(value);
        }
    });
    while (vfLibs.length) {
        vfLibs[0].onload = null;
        vfLibs[0].onerror = null;
        vfLibs[0].remove();
        vfLibs.splice(0, 1);
    }
    var w = window;
    try {
        if (w) {
            if (w.vf) {
                if (w.vf.launcherPlayer && w.vf.launcherPlayer.dispose) {
                    w.vf.launcherPlayer.dispose();
                    w.vf.launcherPlayer = null;
                }
                delete w.vf;
            }
            if (w.gui) {
                delete w.gui;
            }
            if (w.VFConversion) {
                delete w.VFConversion;
            }
        }
    }
    catch (e) {
        //
    }
}
/**
 * vf集成方案加载器
 *
 */
var VIPKIDLauncher = /** @class */ (function () {
    /**
     * 对外接口 IVFEngineAPI
     */
    function VIPKIDLauncher(options, completeCall, errorCall) {
        this._cdnsIndex = 0;
        this._errorCount = 0;
        this._errorMax = 10;
        this.version = "1.6.1";
        // eslint-disable-next-line no-undef
        this.buildInfo = "5/11/2021, 4:45:20 PM";
        /**
         * 是否player项目
         */
        this._isPlayer = true;
        this._progress = [];
        if (completeCall === undefined) {
            throw new Error('VFLauncher constructor Expected 2-3 arguments');
        }
        this._loading = new _Loading__WEBPACK_IMPORTED_MODULE_0__["Loading"](options.container);
        if (window['vf'] === undefined) {
            window['vf'] = {};
        }
        if (!options.scaleMode) {
            options.scaleMode = "showAll" /* SHOW_ALL */;
        }
        if (options.vfvars === undefined) {
            options.vfvars = {};
        }
        if (options.exclude === undefined) {
            options.exclude = [];
        }
        this._engineCDN = Object(_getDefaultCDN__WEBPACK_IMPORTED_MODULE_1__["getDefaultCDN"])();
        // 配置的loading
        if (options.loading) {
            if (options.loading.position) {
                this._loading.position = options.loading.position;
            }
            if (options.loading.image) {
                this._loading.image = options.loading.image;
            }
        }
        options.debugVFPath = Object(_getQueryVariable__WEBPACK_IMPORTED_MODULE_2__["getQueryVariable"])('proxyVF') || options.debugVFPath;
        options.debugGuiPath = Object(_getQueryVariable__WEBPACK_IMPORTED_MODULE_2__["getQueryVariable"])('proxyGUI') || options.debugGuiPath;
        options.debugPlayerPath = Object(_getQueryVariable__WEBPACK_IMPORTED_MODULE_2__["getQueryVariable"])('proxyPlayer') || options.debugPlayerPath;
        this._ops = options;
        this.completeCall = completeCall;
        this.errorCall = errorCall;
        this.loadJs();
    }
    /**
     * 环境依赖配置，可以读取一个engine-vserion.json文件获取版本依赖，由于还需要单独加载（本地动态脚本替换不科学～），为了速度，暂缓修改。
     */
    VIPKIDLauncher.prototype.getLibs = function (index) {
        // if (process.env.NODE_ENV === 'production')
        var ops = this._ops;
        var cdn = this._engineCDN.default[index];
        var libs = [];
        var canLibs = [];
        if (ops.debug) {
            libs.push({ url: cdn + "vf/engine/debug/vconsole.min.js", version: 'vconsole' });
        }
        if (ops.showFPS) {
            libs.push({ url: cdn + "vf/engine/debug/stats.min.js", version: 'stats' });
        }
        var libUrl = '';
        if (ops.exclude) {
            if (ops.exclude.indexOf('vf') === -1) {
                libUrl = ops.debugVFPath || cdn + "vf/engine/vf-v" + "6.0.2-v58" + "/vf.min.js";
                libs.push({ url: libUrl, version: "vf-v" + "6.0.2-v58" });
            }
            if (ops.exclude.indexOf('gui') === -1) {
                libUrl = ops.debugGuiPath || cdn + "vf/engine/gui-v" + "2.6.1" + "/gui.min.js";
                libs.push({ url: libUrl, version: "gui-v" + "2.6.1" });
            }
            if (ops.exclude.indexOf('player') === -1) {
                libUrl = ops.debugPlayerPath || cdn + "vf/engine/player-v" + "1.6.1" + "/player.min.js";
                libs.push({ url: libUrl, version: "player-v" + "1.6.1" });
            }
            else {
                this._isPlayer = false; // 独立项目，非player项目
            }
        }
        if (ops.libs) {
            ops.libs.forEach(function (value, index) {
                libs.push({ url: value, version: "vf-lib-" + index + "-" + performance.now() });
            });
        }
        libs.forEach(function (value) {
            if (document.getElementById(value.version) === null) {
                canLibs.push(value);
            }
        });
        return canLibs;
    };
    VIPKIDLauncher.prototype.loadJs = function () {
        var _this = this;
        var libs = this.getLibs(this._cdnsIndex);
        if (libs.length === 0) {
            if (!this.checkLoadStates()) {
                return;
            }
            this.createEngine();
            return;
        }
        this._loading.show();
        libs.forEach(function (item) {
            _this._progress.push(_this.cretaeScript(item.url, item.version, "1.6.1"));
        });
    };
    VIPKIDLauncher.prototype.checkLoadStates = function () {
        var scripts = document.getElementsByName('vf-script');
        var version = "1.6.1";
        for (var i = 0; i < scripts.length; i++) {
            if (scripts[i].title === version && scripts[i].getAttribute('isLoad') === 'false') {
                return false;
            }
        }
        return true;
    };
    VIPKIDLauncher.prototype.cretaeScript = function (src, id, titile) {
        var script = document.createElement('script');
        script.setAttribute('name', 'vf-script');
        script.setAttribute('isLoad', 'false');
        script.setAttribute('crossorigin', 'anonymous'); // 页面window.onerror可以拿到引擎中js报错信息
        script.type = 'text/javascript';
        script.id = id;
        script.title = titile;
        script.async = false;
        script.src = src;
        script.onload = this.onJsComplete.bind(this);
        script.onerror = this.onJsError.bind(this);
        document.body.appendChild(script);
        return script;
    };
    VIPKIDLauncher.prototype.onJsComplete = function (evt) {
        var script = evt.target;
        script.setAttribute('isLoad', 'true');
        var isLoadComplete = true;
        this._progress.forEach(function (value) {
            if (value.getAttribute('isLoad') === 'false') {
                isLoadComplete = false;
            }
        });
        if (isLoadComplete) {
            this.createEngine();
        }
    };
    VIPKIDLauncher.prototype.onJsError = function (evt) {
        var script = evt.target;
        if (this._errorCount > this._errorMax) {
            if (this.errorCall) {
                this.errorCall({
                    code: 'LoadError',
                    level: 'error',
                    data: [script.src],
                });
            }
            return;
        }
        var progress = this._progress;
        var index = progress.indexOf(evt.target);
        var cdn = this._engineCDN.default[this._cdnsIndex % this._engineCDN.default.length];
        this._cdnsIndex++;
        this._errorCount++;
        var path = script.src.substr(script.src.indexOf('/', 10) + 1);
        script.src = cdn + path;
        for (var i = index; i < progress.length; i++) {
            this.removeScriptEvent(progress[i]);
            progress[i].remove();
            progress[i] = this.cretaeScript(progress[i].src, progress[i].id, progress[i].title);
        }
    };
    VIPKIDLauncher.prototype.removeScriptEvent = function (script) {
        script.onload = null;
        script.onerror = null;
    };
    VIPKIDLauncher.prototype.clearCachePlayer = function () {
        var w = window;
        if (w['vf'] && w['vf']['launcherPlayer'] && w['vf']['launcherPlayer'].dispose) {
            w['vf']['launcherPlayer'].dispose();
            w['vf']['launcherPlayer'] = null;
        }
    };
    /**
     * 创建引擎
     */
    VIPKIDLauncher.prototype.createEngine = function () {
        if (this.completeCall) {
            var deviceType = vf.utils.getSystemInfo().device.type;
            if (this._ops.debug && (deviceType === 'mobile' || deviceType === 'tablet')) { // 移动设备显示调试面板
                // eslint-disable-next-line no-new
                var vfConsole = new window.VConsole();
                if (this._ops.showConsole) {
                    vfConsole.show();
                }
            }
            if (this._ops.showFPS) { // 显示帧率
                var stats_1 = new window.Stats();
                stats_1.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
                document.body.appendChild(stats_1.dom);
                var animate_1 = function () {
                    stats_1.begin();
                    // monitored code goes here
                    stats_1.end();
                    requestAnimationFrame(animate_1);
                };
                requestAnimationFrame(animate_1);
            }
            vf.utils.skipHello();
            if (this._isPlayer) { // 如果排除库中没有player，即创建
                var player = new window['vf']['player']['Player'](this._ops);
                this.clearCachePlayer();
                window['vf']['launcherPlayer'] = player;
                this.completeCall(player);
            }
            else {
                this.completeCall(new _CreateApp__WEBPACK_IMPORTED_MODULE_3__["CreateApp"](this._ops));
            }
            vf.utils.versionPrint(this.version);
            this.completeCall = undefined;
            this.errorCall = undefined;
        }
        this._loading.hide();
        this._loading.dispose();
    };
    return VIPKIDLauncher;
}());

function createVF(options, completeCall, errorCall) {
    var scripts = document.getElementsByName('vf-script');
    var version = "1.6.1";
    for (var i = 0; i < scripts.length; i++) {
        if (scripts[i].title !== version && scripts[i].title !== '') {
            deleteVF();
            break;
        }
    }
    // eslint-disable-next-line no-new
    new VIPKIDLauncher(options, completeCall, errorCall);
}


/***/ }),

/***/ "./packages/launcher/src/Loading.ts":
/*!******************************************!*\
  !*** ./packages/launcher/src/Loading.ts ***!
  \******************************************/
/*! exports provided: Loading */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Loading", function() { return Loading; });
/* harmony import */ var _assets_loading2_svg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../assets/loading2.svg */ "./assets/loading2.svg");

var Loading = /** @class */ (function () {
    function Loading(div) {
        this._isShow = false;
        /**
         * 设置位置，默认右下
         */
        this.position = 'rightBottom';
        this._parent = div;
        this._image = _assets_loading2_svg__WEBPACK_IMPORTED_MODULE_0__["default"];
    }
    Object.defineProperty(Loading.prototype, "image", {
        get: function () {
            return this._image;
        },
        /** 设置显示位图 */
        set: function (value) {
            if (this._loadingImg) {
                this._loadingImg.src = value;
            }
            this._image = value;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * 关于Loading界面布局的可以提出去
     */
    Loading.prototype.show = function () {
        if (!this._parent) {
            return;
        }
        var _container = this._parent;
        if (this._isShow) {
            return;
        }
        if (!this._image) {
            return;
        }
        this._isShow = true;
        var img = this._loadingImg = new Image();
        img.name = 'vf-loading';
        img.id = Date.now().toString();
        img.style.position = 'absolute';
        img.src = this._image;
        var bound = this.getInnerBound(_container);
        var loadingPostion = this.position;
        img.onload = function () {
            // 临时 默认右下
            var left = (bound.w - img.width);
            var top = (bound.h - img.height);
            switch (loadingPostion) {
                case 'leftTop':
                    left = 0;
                    top = 0;
                    break;
                case 'rightTop':
                    left = (bound.w - img.width);
                    top = 0;
                    break;
                case 'leftBottom':
                    left = 0;
                    top = (bound.h - img.height);
                    break;
                case 'rightBottom':
                    left = (bound.w - img.width);
                    top = (bound.h - img.height);
                    break;
                default: // center
                    left = (bound.w - img.width) >> 1;
                    top = (bound.h - img.height) >> 1;
            }
            if (Array.isArray(loadingPostion)) {
                left = loadingPostion[0];
                top = loadingPostion[1];
            }
            img.style.left = left + "px";
            img.style.top = top + "px";
            _container.appendChild(img);
        };
    };
    /**
     * 关于Loading界面布局的可以提出去
     */
    Loading.prototype.hide = function () {
        var loading = this._loadingImg;
        if (loading && loading.parentNode) {
            loading.onload = null;
            loading.parentNode.removeChild(loading);
            loading.remove();
            // this._loading = undefined;
        }
        this._isShow = false;
    };
    Loading.prototype.dispose = function () {
        this._loadingImg = undefined;
        this._parent = undefined;
        this._image = undefined;
    };
    Loading.prototype.getInnerBound = function (ele) {
        var parentElement = ele;
        var w = ele.clientWidth;
        var h = ele.clientHeight;
        for (var i = 0; i < 5; i++) {
            if (parentElement.clientWidth === 0 && parentElement.parentElement) {
                parentElement = parentElement.parentElement;
            }
            else {
                w = parentElement.clientWidth;
                h = parentElement.clientHeight;
                break;
            }
        }
        return { w: w, h: h };
    };
    return Loading;
}());



/***/ }),

/***/ "./packages/launcher/src/getDefaultCDN.ts":
/*!************************************************!*\
  !*** ./packages/launcher/src/getDefaultCDN.ts ***!
  \************************************************/
/*! exports provided: getDefaultCDN */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getDefaultCDN", function() { return getDefaultCDN; });
/**
 * 获取默认CDN
 * @param isProd
 */
function getDefaultCDN() {
    return {
        default: [
            'https://s.vipkidstatic.com/',
            'https://s.vipkidresource.com/',
        ],
        image: [
            'https://img.vipkidstatic.com/',
            'https://img.vipkidresource.com/',
        ],
        media: [
            'https://media.vipkidstatic.com/',
            'https://media.vipkidresource.com/',
        ],
        wx: [
            'https://wx.vipkidstatic.com/',
            'https://wx.vipkidresource.com/',
        ],
    };
}


/***/ }),

/***/ "./packages/launcher/src/getQueryVariable.ts":
/*!***************************************************!*\
  !*** ./packages/launcher/src/getQueryVariable.ts ***!
  \***************************************************/
/*! exports provided: getQueryVariable */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getQueryVariable", function() { return getQueryVariable; });
function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');
        if (pair[0] === variable) {
            return pair[1];
        }
    }
    return undefined;
}


/***/ }),

/***/ "./packages/launcher/src/index.ts":
/*!****************************************!*\
  !*** ./packages/launcher/src/index.ts ***!
  \****************************************/
/*! exports provided: deleteVF, VIPKIDLauncher, createVF */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _Launcher__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Launcher */ "./packages/launcher/src/Launcher.ts");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "deleteVF", function() { return _Launcher__WEBPACK_IMPORTED_MODULE_0__["deleteVF"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "VIPKIDLauncher", function() { return _Launcher__WEBPACK_IMPORTED_MODULE_0__["VIPKIDLauncher"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "createVF", function() { return _Launcher__WEBPACK_IMPORTED_MODULE_0__["createVF"]; });




/***/ })

/******/ });
});
//# sourceMappingURL=launcher.js.map